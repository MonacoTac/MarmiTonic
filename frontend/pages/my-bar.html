<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Mon Bar - MarmiTonic</title>
</head>
<body>
    <header>
        <nav id="navbar" class="navbar">
            <div class="navbar-left">
                <a href="discovery.html" class="link-main">
                    <div h="full" class="hover-underline-animation">                        
                        Explorer
                    </div>
                </a>
                <a href="my-bar.html" class="link-main active">
                    <div h="full" class="hover-underline-animation">                        
                        Mon Bar
                    </div>
                </a>
                <a href="planner.html" class="link-main">
                    <div h="full" class="hover-underline-animation">                        
                        Planificateur
                    </div>
                </a>
            </div>
            <div class="navbar-center">
                <img src="../assets/logo.png" alt="MarmiTonic Logo">
                <a href="../index.html" class="link-main">
                <span>MarmiTonic</span>
                </a>
            </div>
            <div class="navbar-right">
                <input type="text" placeholder="Recherche">
                <img src="../assets/account.png" alt="">
            </div>
        </nav>
        
        <div id="no-navbar-menu" class="no-navbar-menu">
            <i class="fa fa-bars" aria-hidden="true"></i>
            <p>Menu</p>
        </div>
    </header>
    <main class="page-container">
        <div class="my-bar-container">
            <h1 class="page-title">Mon Bar</h1>
            <p class="page-subtitle">G√©rez votre inventaire d'ingr√©dients et d√©couvrez les cocktails que vous pouvez pr√©parer</p>
            
            <div class="my-bar-content">
                <!-- Ingredient Selection Section -->
                <div class="inventory-section">
                    <div class="section-header">
                        <h2>Mes Ingr√©dients</h2>
                        <div class="search-box">
                            <input type="text" id="ingredientSearch" placeholder="Rechercher un ingr√©dient..." />
                            <i class="fa fa-search"></i>
                        </div>
                    </div>
                    
                    <div class="selection-stats">
                        <span id="selectionCount">0 ingr√©dient(s) s√©lectionn√©(s)</span>
                        <button id="clearAll" class="btn-link">Tout d√©s√©lectionner</button>
                    </div>
                    
                    <div class="ingredient-categories">
                        <button class="category-filter active" data-category="all">Tous</button>
                        <button class="category-filter" data-category="spirits">Spiritueux</button>
                        <button class="category-filter" data-category="liqueurs">Liqueurs</button>
                        <button class="category-filter" data-category="mixers">Mixers</button>
                        <button class="category-filter" data-category="fresh">Frais</button>
                        <button class="category-filter" data-category="garnish">Garnitures</button>
                    </div>
                    
                    <div id="ingredientList" class="ingredient-list">
                        <!-- Ingredients will be populated here -->
                    </div>
                    
                    <button id="findCocktails" class="btn-primary">
                        <i class="fa fa-search"></i> Trouver des Cocktails
                    </button>
                </div>
                
                <!-- Results Section -->
                <div class="results-section">
                    <div class="results-header">
                        <h2>Cocktails Possibles</h2>
                        <select id="sortBy" class="sort-select">
                            <option value="makeable">R√©alisables en premier</option>
                            <option value="missing">Moins d'ingr√©dients manquants</option>
                            <option value="name">Nom (A-Z)</option>
                        </select>
                    </div>
                    
                    <div id="cocktailResults" class="cocktail-results">
                        <div class="empty-state">
                            <i class="fa fa-cocktail"></i>
                            <p>S√©lectionnez vos ingr√©dients et cliquez sur "Trouver des Cocktails"</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
        let prevScrollPos = window.pageYOffset;

        menuNoNavbar = document.getElementById("no-navbar-menu");
        menuNoNavbar.style.display = "none";

        menuNoNavbar.onclick = function(){
            document.getElementById("navbar").classList.remove("hide");
            menuNoNavbar.style.display="none";
        };
    </script>
    <script src="../js/app.js"></script>
    <script src="../js/api.js"></script>
    <script>
        // Mock ingredient data (will be replaced with API call later)
        const mockIngredients = [
            // Spirits
            { id: 1, name: "Vodka", category: "spirits", image: "ü•É" },
            { id: 2, name: "Gin", category: "spirits", image: "üç∏" },
            { id: 3, name: "Rhum Blanc", category: "spirits", image: "ü•É" },
            { id: 4, name: "Rhum Brun", category: "spirits", image: "ü•É" },
            { id: 5, name: "Tequila", category: "spirits", image: "ü•É" },
            { id: 6, name: "Whisky", category: "spirits", image: "ü•É" },
            { id: 7, name: "Bourbon", category: "spirits", image: "ü•É" },
            { id: 8, name: "Cognac", category: "spirits", image: "ü•É" },
            
            // Liqueurs
            { id: 9, name: "Triple Sec", category: "liqueurs", image: "üçä" },
            { id: 10, name: "Cointreau", category: "liqueurs", image: "üçä" },
            { id: 11, name: "Amaretto", category: "liqueurs", image: "üå∞" },
            { id: 12, name: "Kahl√∫a", category: "liqueurs", image: "‚òï" },
            { id: 13, name: "Baileys", category: "liqueurs", image: "ü•õ" },
            { id: 14, name: "Campari", category: "liqueurs", image: "üç∑" },
            { id: 15, name: "Vermouth Sec", category: "liqueurs", image: "üç∑" },
            { id: 16, name: "Vermouth Doux", category: "liqueurs", image: "üç∑" },
            
            // Mixers
            { id: 17, name: "Jus de Citron", category: "mixers", image: "üçã" },
            { id: 18, name: "Jus de Lime", category: "mixers", image: "üçã" },
            { id: 19, name: "Jus d'Orange", category: "mixers", image: "üçä" },
            { id: 20, name: "Jus de Cranberry", category: "mixers", image: "ü´ê" },
            { id: 21, name: "Jus d'Ananas", category: "mixers", image: "üçç" },
            { id: 22, name: "Soda", category: "mixers", image: "ü•§" },
            { id: 23, name: "Tonic", category: "mixers", image: "ü•§" },
            { id: 24, name: "Cola", category: "mixers", image: "ü•§" },
            { id: 25, name: "Ginger Beer", category: "mixers", image: "ü•§" },
            
            // Fresh
            { id: 26, name: "Citron", category: "fresh", image: "üçã" },
            { id: 27, name: "Lime", category: "fresh", image: "üçã" },
            { id: 28, name: "Menthe", category: "fresh", image: "üåø" },
            { id: 29, name: "Sucre", category: "fresh", image: "üßÇ" },
            { id: 30, name: "Sirop Simple", category: "fresh", image: "üçØ" },
            { id: 31, name: "Angostura Bitters", category: "fresh", image: "üíß" },
            { id: 32, name: "Gla√ßons", category: "fresh", image: "üßä" },
            
            // Garnish
            { id: 33, name: "Cerises", category: "garnish", image: "üçí" },
            { id: 34, name: "Olives", category: "garnish", image: "ü´í" },
            { id: 35, name: "Sel", category: "garnish", image: "üßÇ" },
            { id: 36, name: "Sucre de Canne", category: "garnish", image: "üßÇ" }
        ];
        
        // Mock cocktail data with ingredients
        const mockCocktails = [
            { id: 1, name: "Mojito", image: "üçπ", ingredients: ["Rhum Blanc", "Lime", "Menthe", "Sucre", "Soda", "Gla√ßons"] },
            { id: 2, name: "Margarita", image: "üçπ", ingredients: ["Tequila", "Triple Sec", "Jus de Lime", "Sel", "Gla√ßons"] },
            { id: 3, name: "Cosmopolitan", image: "üç∏", ingredients: ["Vodka", "Triple Sec", "Jus de Lime", "Jus de Cranberry", "Gla√ßons"] },
            { id: 4, name: "Gin Tonic", image: "üç∏", ingredients: ["Gin", "Tonic", "Citron", "Gla√ßons"] },
            { id: 5, name: "Old Fashioned", image: "ü•É", ingredients: ["Bourbon", "Sucre", "Angostura Bitters", "Cerises", "Gla√ßons"] },
            { id: 6, name: "Manhattan", image: "üç∏", ingredients: ["Whisky", "Vermouth Doux", "Angostura Bitters", "Cerises", "Gla√ßons"] },
            { id: 7, name: "Martini", image: "üç∏", ingredients: ["Gin", "Vermouth Sec", "Olives", "Gla√ßons"] },
            { id: 8, name: "Pi√±a Colada", image: "üçπ", ingredients: ["Rhum Blanc", "Jus d'Ananas", "Gla√ßons"] },
            { id: 9, name: "Daiquiri", image: "üçπ", ingredients: ["Rhum Blanc", "Jus de Lime", "Sirop Simple", "Gla√ßons"] },
            { id: 10, name: "Moscow Mule", image: "üç∫", ingredients: ["Vodka", "Ginger Beer", "Lime", "Gla√ßons"] },
            { id: 11, name: "Negroni", image: "üç∑", ingredients: ["Gin", "Campari", "Vermouth Doux", "Gla√ßons"] },
            { id: 12, name: "Whisky Sour", image: "ü•É", ingredients: ["Whisky", "Jus de Citron", "Sirop Simple", "Gla√ßons"] },
            { id: 13, name: "Cuba Libre", image: "ü•É", ingredients: ["Rhum Blanc", "Cola", "Lime", "Gla√ßons"] },
            { id: 14, name: "Screwdriver", image: "üçä", ingredients: ["Vodka", "Jus d'Orange", "Gla√ßons"] },
            { id: 15, name: "Tequila Sunrise", image: "üåÖ", ingredients: ["Tequila", "Jus d'Orange", "Gla√ßons"] }
        ];
        
        let selectedIngredients = new Set();
        let currentCategory = 'all';
        let currentIngredients = mockIngredients;
        
        // Initialize the page
        function init() {
            renderIngredients();
            setupEventListeners();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Search functionality
            document.getElementById('ingredientSearch').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = mockIngredients.filter(ing => 
                    ing.name.toLowerCase().includes(searchTerm)
                );
                renderIngredients(filtered);
            });
            
            // Category filters
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.category-filter').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentCategory = e.target.dataset.category;
                    filterByCategory(currentCategory);
                });
            });
            
            // Clear all button
            document.getElementById('clearAll').addEventListener('click', () => {
                selectedIngredients.clear();
                updateSelectionCount();
                renderIngredients();
            });
            
            // Find cocktails button
            document.getElementById('findCocktails').addEventListener('click', findCocktails);
            
            // Sort select
            document.getElementById('sortBy').addEventListener('change', (e) => {
                if (document.querySelectorAll('.cocktail-card').length > 0) {
                    findCocktails();
                }
            });
        }
        
        // Filter ingredients by category
        function filterByCategory(category) {
            if (category === 'all') {
                currentIngredients = mockIngredients;
            } else {
                currentIngredients = mockIngredients.filter(ing => ing.category === category);
            }
            renderIngredients(currentIngredients);
        }
        
        // Render ingredients
        function renderIngredients(ingredients = currentIngredients) {
            const container = document.getElementById('ingredientList');
            container.innerHTML = '';
            
            ingredients.forEach(ingredient => {
                const div = document.createElement('div');
                div.className = 'ingredient-item';
                div.innerHTML = `
                    <label class="ingredient-checkbox">
                        <input type="checkbox" 
                               id="ing-${ingredient.id}" 
                               value="${ingredient.name}"
                               ${selectedIngredients.has(ingredient.name) ? 'checked' : ''}>
                        <span class="ingredient-icon">${ingredient.image}</span>
                        <span class="ingredient-name">${ingredient.name}</span>
                        <span class="checkmark"></span>
                    </label>
                `;
                
                const checkbox = div.querySelector('input');
                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        selectedIngredients.add(ingredient.name);
                    } else {
                        selectedIngredients.delete(ingredient.name);
                    }
                    updateSelectionCount();
                });
                
                container.appendChild(div);
            });
        }
        
        // Update selection count
        function updateSelectionCount() {
            document.getElementById('selectionCount').textContent = 
                `${selectedIngredients.size} ingr√©dient(s) s√©lectionn√©(s)`;
        }
        
        // Find cocktails based on selected ingredients
        function findCocktails() {
            if (selectedIngredients.size === 0) {
                alert('Veuillez s√©lectionner au moins un ingr√©dient');
                return;
            }
            
            const results = mockCocktails.map(cocktail => {
                const missingIngredients = cocktail.ingredients.filter(ing => 
                    !selectedIngredients.has(ing)
                );
                const matchingIngredients = cocktail.ingredients.filter(ing => 
                    selectedIngredients.has(ing)
                );
                
                return {
                    ...cocktail,
                    missingCount: missingIngredients.length,
                    missingIngredients,
                    matchingIngredients,
                    canMake: missingIngredients.length === 0
                };
            });
            
            // Sort results
            const sortBy = document.getElementById('sortBy').value;
            results.sort((a, b) => {
                if (sortBy === 'makeable') {
                    if (a.canMake !== b.canMake) return a.canMake ? -1 : 1;
                    return a.missingCount - b.missingCount;
                } else if (sortBy === 'missing') {
                    return a.missingCount - b.missingCount;
                } else {
                    return a.name.localeCompare(b.name);
                }
            });
            
            renderCocktailResults(results);
        }
        
        // Render cocktail results
        function renderCocktailResults(results) {
            const container = document.getElementById('cocktailResults');
            container.innerHTML = '';
            
            const makeable = results.filter(r => r.canMake);
            const almostMakeable = results.filter(r => !r.canMake && r.missingCount <= 2);
            
            if (makeable.length > 0) {
                const section = document.createElement('div');
                section.className = 'result-section';
                section.innerHTML = `<h3 class="result-section-title">Cocktails R√©alisables (${makeable.length})</h3>`;
                makeable.forEach(cocktail => {
                    section.appendChild(createCocktailCard(cocktail));
                });
                container.appendChild(section);
            }
            
            if (almostMakeable.length > 0) {
                const section = document.createElement('div');
                section.className = 'result-section';
                section.innerHTML = `<h3 class="result-section-title">Presque R√©alisables (${almostMakeable.length})</h3>`;
                almostMakeable.forEach(cocktail => {
                    section.appendChild(createCocktailCard(cocktail));
                });
                container.appendChild(section);
            }
            
            if (makeable.length === 0 && almostMakeable.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fa fa-frown-o"></i>
                        <p>Aucun cocktail ne correspond √† votre s√©lection</p>
                        <small>Essayez d'ajouter plus d'ingr√©dients √† votre bar</small>
                    </div>
                `;
            }
        }
        
        // Create cocktail card
        function createCocktailCard(cocktail) {
            const div = document.createElement('div');
            div.className = `my-bar-cocktail-card ${cocktail.canMake ? 'can-make' : 'almost-make'}`;
            
            const missingText = cocktail.canMake 
                ? '<span class="badge-success">Tous les ingr√©dients disponibles !</span>'
                : `<span class="badge-warning">Il manque ${cocktail.missingCount} ingr√©dient(s): ${cocktail.missingIngredients.join(', ')}</span>`;
            
            div.innerHTML = `
                <div class="cocktail-icon">${cocktail.image}</div>
                <div class="cocktail-info">
                    <h4 class="cocktail-name">${cocktail.name}</h4>
                    <div class="cocktail-status">${missingText}</div>
                    <div class="ingredient-chips">
                        ${cocktail.ingredients.map(ing => 
                            `<span class="chip ${selectedIngredients.has(ing) ? 'chip-have' : 'chip-need'}">${ing}</span>`
                        ).join('')}
                    </div>
                </div>
            `;
            
            return div;
        }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>